<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ö–∞—Ç–∞–ª–æ–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ ‚Äî v1.5.1</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
<style>
:root{--bg:#f6f7fb;--card:#fff;--text:#0f172a;--muted:#64748b;--accent:#2563eb;--bad:#dc2626;--border:#e5e7eb}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
.wrap{max-width:1160px;margin:0 auto;padding:16px}
h1{font-size:26px;margin:8px 0 4px}.sub{color:var(--muted);margin:0 0 14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin:10px 0;box-shadow:0 4px 18px rgba(0,0,0,.04)}
.row{display:flex;gap:10px;flex-wrap:wrap}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px}
input,select,button{border:1px solid var(--border);border-radius:10px;padding:10px;font-size:14px;background:#fff;color:var(--text)}
.btn{cursor:pointer}.btn-primary{background:var(--accent);color:#fff;border-color:#1e40af}
.btn-ghost{background:#fff}.btn-danger{background:#fff;color:var(--bad);border-color:#fecaca}
.list{display:grid;gap:10px}
.item{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}
.pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--muted);margin-right:4px}
.section-title{font-weight:700;margin:8px 0}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:999px;padding:4px 8px}
.chip .x{cursor:pointer;border:1px solid var(--border);border-radius:6px;background:#fff;padding:0 6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>üè† –ö–∞—Ç–∞–ª–æ–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ ‚Äî v1.5.1</h1>
  <div class="sub">–§–∏–ª—å—Ç—Ä—ã –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ + –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–≤–∞—Ä—Ç–∞–ª–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏</div>

  <div class="grid grid-2">
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="card" id="filtersCard">
      <div class="section-title">–§–∏–ª—å—Ç—Ä</div>
      <div class="row" id="f_districts"></div>
      <div class="row" id="f_quarters_box"></div>
      <button class="btn btn-primary" id="btnApply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>

    <!-- –ê–¥–º–∏–Ω–∫–∞ -->
    <div class="card">
      <div class="section-title">–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</div>
      <div class="row">
        <div><label>–†–∞–π–æ–Ω</label><select id="a_district"></select></div>
        <div><label>–ö–≤–∞—Ä—Ç–∞–ª/–º–∞—Ö–∞–ª—è</label><select id="a_quarter"></select></div>
      </div>
      <div class="row"><button class="btn btn-primary" id="btnAdd">–î–æ–±–∞–≤–∏—Ç—å</button></div>

      <div class="section-title" style="margin-top:16px">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ª–æ–∫–∞—Ü–∏–π</div>
      <div class="row">
        <div><label>–†–∞–π–æ–Ω</label><select id="loc_district"></select></div>
        <div><label>–ù–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è</label><input id="loc_new"></div>
        <button class="btn btn-primary" id="loc_add">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div id="loc_list" class="chips"></div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
    <div id="results" class="list"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const DISTRICTS=["–Æ–Ω—É—Å–∞–±–∞–¥","–ß–∏–ª–∞–Ω–∑–∞—Ä","–°–µ—Ä–≥–µ–ª–∏–π—Å–∫–∏–π"];
  let locations={
    "–Æ–Ω—É—Å–∞–±–∞–¥":["1 –∫–≤–∞—Ä—Ç–∞–ª","2 –∫–≤–∞—Ä—Ç–∞–ª","9 –∫–≤–∞—Ä—Ç–∞–ª"],
    "–ß–∏–ª–∞–Ω–∑–∞—Ä":["1 –∫–≤–∞—Ä—Ç–∞–ª","20 –∫–≤–∞—Ä—Ç–∞–ª"],
    "–°–µ—Ä–≥–µ–ª–∏–π—Å–∫–∏–π":["–ö—É–π–ª—é–∫ 1 –∫–≤–∞—Ä—Ç–∞–ª","–ö—É–π–ª—é–∫ 5 –∫–≤–∞—Ä—Ç–∞–ª"]
  };
  let objects=[];

  const $=id=>document.getElementById(id);
  const el=(t,a={},h="")=>{const e=document.createElement(t);for(const k in a) e.setAttribute(k,a[k]);if(h)e.innerHTML=h;return e};

  function renderDistricts(){
    const box=$("f_districts"), selA=$("a_district"), selLoc=$("loc_district");
    box.innerHTML=""; selA.innerHTML=""; selLoc.innerHTML="";
    DISTRICTS.forEach(d=>{
      const l=el("label"); const cb=el("input",{type:"checkbox","data-district":d});
      l.appendChild(cb); l.append(" "+d); box.appendChild(l);
      const opt=el("option",{value:d},d); selA.appendChild(opt);
      const opt2=el("option",{value:d},d); selLoc.appendChild(opt2);
    });
  }

  function renderQuarterCheckboxes(){
    const chosen=Array.from($("f_districts").querySelectorAll("input:checked")).map(cb=>cb.getAttribute("data-district"));
    const box=$("f_quarters_box"); box.innerHTML="";
    chosen.forEach(d=>{
      (locations[d]||[]).forEach(q=>{
        const l=el("label"); const cb=el("input",{type:"checkbox","data-quarter":q});
        l.appendChild(cb); l.append(" "+q); box.appendChild(l);
      });
    });
  }

  function renderQuarterSelect(){
    const d=$("a_district").value; const sel=$("a_quarter");
    sel.innerHTML="";
    (locations[d]||[]).forEach(q=>{
      sel.appendChild(el("option",{value:q},q));
    });
  }

  function addObject(){
    const d=$("a_district").value, q=$("a_quarter").value;
    objects.push({district:d, quarter:q});
    renderResults();
  }

  function renderResults(){
    const res=$("results"); res.innerHTML="";
    objects.forEach((o,i)=>{
      const div=el("div",{class:"item"},`${o.district}, ${o.quarter}`);
      const del=el("button",{class:"btn btn-danger"},"–£–¥–∞–ª–∏—Ç—å");
      del.onclick=()=>{objects.splice(i,1);renderResults()};
      div.appendChild(document.createElement("br"));
      div.appendChild(del);
      res.appendChild(div);
    });
  }

  function renderLocList(){
    const d=$("loc_district").value; const box=$("loc_list"); box.innerHTML="";
    (locations[d]||[]).forEach((q,i)=>{
      const chip=el("div",{class:"chip"},q+" ");
      const x=el("button",{class:"x"},"‚úï"); x.onclick=()=>{locations[d].splice(i,1);renderLocList();};
      chip.appendChild(x); box.appendChild(chip);
    });
    renderQuarterSelect();
    renderQuarterCheckboxes();
  }

  $("f_districts").addEventListener("change",renderQuarterCheckboxes);
  $("a_district").addEventListener("change",renderQuarterSelect);
  $("loc_district").addEventListener("change",renderLocList);
  $("btnAdd").addEventListener("click",addObject);
  $("loc_add").addEventListener("click",()=>{const d=$("loc_district").value; const v=$("loc_new").value.trim(); if(v){locations[d].push(v);$("loc_new").value="";renderLocList();}});

  renderDistricts(); renderQuarterCheckboxes(); renderQuarterSelect(); renderLocList();
});
</script>
</body>
</html>
